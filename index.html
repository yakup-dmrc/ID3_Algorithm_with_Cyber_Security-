<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <title>Siber Güvenlik: ID3 PRNG Analizörü</title>
    <style>
        :root {
            --neon-green: #00ff41;
            --dark-bg: #0d0d0d;
            --terminal-text: #00cc00;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--terminal-text);
            font-family: 'Courier New', monospace;
            padding: 20px;
        }

        .container {
            border: 2px solid var(--neon-green);
            padding: 20px;
            box-shadow: 0 0 15px var(--neon-green);
            border-radius: 10px;
        }

        h1,
        h2 {
            text-transform: uppercase;
            border-bottom: 1px solid var(--neon-green);
            padding-bottom: 10px;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        textarea {
            width: 100%;
            height: 180px;
            background: #000;
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            padding: 10px;
            font-size: 14px;
        }

        button {
            background: var(--neon-green);
            color: black;
            border: none;
            padding: 12px 20px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }

        button:hover {
            background: #008f11;
            color: white;
        }

        #treeDisplay {
            background: rgba(0, 255, 65, 0.05);
            border: 1px dashed var(--neon-green);
            padding: 15px;
            overflow-x: auto;
            min-height: 200px;
            margin-top: 20px;
        }

        .test-panel {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            display: none;
        }

        .leaf-node {
            color: #fff;
            background: #008f11;
            padding: 2px 5px;
            border-radius: 3px;
        }

        .feature-node {
            color: #ff00ff;
            font-weight: bold;
        }

        .gain-info {
            color: #888;
            font-size: 0.8em;
            font-style: italic;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>[ANALYSIS] PRNG_DETECTOR_v1.0</h1>
        <p>> Sistem Durumu: Analiz Bekleniyor... Veri setini girin ve algoritmayı çalıştırın.</p>

        <div class="grid">
            <div class="input-section">
                <h2>1. VERI SETI (TRAIN)</h2>
                <textarea id="csvInput">Bit_n-1,Bit_n-2,Gurultu,Hedef_Bit
1,0,1,1
0,1,0,1
1,1,1,0
0,0,0,0
1,0,0,1
0,1,1,1
1,1,0,0
0,0,1,0</textarea>
                <button onclick="startAnalysis()">ANALİZİ BAŞLAT (EĞİT)</button>
            </div>

            <div class="output-section">
                <h2>2. KARAR AĞACI MANTIĞI</h2>
                <div id="treeDisplay">// Mantıksal ağaç burada inşa edilecek...</div>
            </div>
        </div>

        <div id="testPanel" class="test-panel">
            <h2>3. GERÇEK ZAMANLI TAHMİN (TEST)</h2>
            <div id="inputControls"></div>
            <button onclick="runTest()">SONUCU TAHMİN ET</button>
            <h3 id="testResult" style="color: white; margin-top: 15px;"></h3>
        </div>
    </div>

    <script>
        let trainedTree = null;
        let headers = [];

        // --- MATEMATİKSEL ÇEKİRDEK ---

        function calculateEntropy(rows) {
            const targetIdx = rows[0].length - 1;
            const counts = {};
            rows.forEach(row => counts[row[targetIdx]] = (counts[row[targetIdx]] || 0) + 1);
            return Object.values(counts).reduce((acc, count) => {
                let p = count / rows.length;
                return acc - p * Math.log2(p);
            }, 0);
        }

        function getInformationGain(rows, colIdx) {
            const baseEntropy = calculateEntropy(rows);
            const uniqueValues = [...new Set(rows.map(r => r[colIdx]))];
            let subsetEntropy = 0;

            uniqueValues.forEach(val => {
                const subset = rows.filter(r => r[colIdx] === val);
                subsetEntropy += (subset.length / rows.length) * calculateEntropy(subset);
            });
            return { gain: baseEntropy - subsetEntropy, values: uniqueValues };
        }

        function id3(rows, currentHeaders) {
            const targetIdx = rows[0].length - 1;
            const labels = rows.map(r => r[targetIdx]);

            // Durma Koşulu 1: Hepsi aynı sınıftaysa
            if (new Set(labels).size === 1) return { result: labels[0] };

            // Durma Koşulu 2: Sütun kalmadıysa en çok olanı ver
            if (currentHeaders.length === 1) return { result: "BELİRSİZ" };

            let bestGain = -1;
            let bestCol = -1;

            for (let i = 0; i < currentHeaders.length - 1; i++) {
                let { gain } = getInformationGain(rows, i);
                if (gain > bestGain) {
                    bestGain = gain;
                    bestCol = i;
                }
            }

            if (bestGain <= 0) {
                const counts = {};
                rows.forEach(r => counts[r[targetIdx]] = (counts[r[targetIdx]] || 0) + 1);
                return { result: Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b) + " (Düşük Güven)" };
            }

            const node = { feature: currentHeaders[bestCol], branches: {}, gain: bestGain };
            const values = [...new Set(rows.map(r => r[bestCol]))];

            values.forEach(val => {
                const subset = rows.filter(r => r[bestCol] === val).map(r => r.filter((_, idx) => idx !== bestCol));
                const subHeaders = currentHeaders.filter((_, idx) => idx !== bestCol);
                node.branches[val] = id3(subset, subHeaders);
            });

            return node;
        }

        // --- GÖRSELLEŞTİRME VE TEST ---

        function startAnalysis() {
            const rawData = document.getElementById('csvInput').value.trim().split('\n').map(l => l.split(','));
            headers = rawData[0];
            const dataRows = rawData.slice(1);

            trainedTree = id3(dataRows, headers);
            document.getElementById('treeDisplay').innerHTML = renderTree(trainedTree);

            setupTestPanel();
        }

        function renderTree(node, depth = 0) {
            if (node.result) return ` <span class="leaf-node">${node.result}</span>\n`;

            let html = `<span class="feature-node">${node.feature}</span> <span class="gain-info">(Gain: ${node.gain.toFixed(2)})</span>\n`;
            const indent = "&nbsp;&nbsp;&nbsp;&nbsp;".repeat(depth + 1);
            for (let val in node.branches) {
                html += `${indent}├── [${val}] ise ${renderTree(node.branches[val], depth + 1)}`;
            }
            return html;
        }

        function setupTestPanel() {
            const panel = document.getElementById('testPanel');
            const controls = document.getElementById('inputControls');
            panel.style.display = "block";
            controls.innerHTML = "";

            headers.slice(0, -1).forEach(h => {
                controls.innerHTML += `<label>${h}:</label> <input type="text" id="test_${h}" style="background:#000; color:#00ff41; border:1px solid #00ff41; margin-bottom:10px;"><br>`;
            });
        }

        function predict(node, input) {
            if (node.result) return node.result;
            const val = input[node.feature];
            if (node.branches[val]) return predict(node.branches[val], input);
            return "TANIMLANAMAYAN DİZİ";
        }

        function runTest() {
            const userInput = {};
            headers.slice(0, -1).forEach(h => {
                userInput[h] = document.getElementById(`test_${h}`).value;
            });
            const result = predict(trainedTree, userInput);
            document.getElementById('testResult').innerHTML = "> TAHMİN EDİLEN BİT DURUMU: " + result;
        }
    </script>

</body>

</html>